##################################################################

##################################################################

##################################################################

##################################################################

##################################################################

##################################################################

##################################################################

##################################################################

##################################################################

##################################################################

##################################################################

##################################################################
[hobit]
import sys
input = sys.stdin.readline
INF = 10**18
N, M = map(int, input().split())
G = [[INF]*(N+1) for i in range(N+1)]  # v=0: sky
for i in range(N+1):
    G[i][i] = 0
for _ in range(M):
    a, b, c = map(int, input().split())
    G[a][b] = G[b][a] = min(G[a][b], c*2)  # a<->b, cost=c*2
K, T = map(int, input().split())
for i in map(int, input().split()):  # D
    G[0][i] = G[i][0] = T  # i<->sky, cost=T


def update(k):
    for i in range(N+1):
        if G[k][i] < INF:
            for j in range(i):  # å¯¾è§’ç·šä¸Šã«ã¤ã„ã¦å¯¾è±¡ã§ã‚ã‚‹å‰æã§
                G[j][i] = G[i][j] = min(G[i][j], G[i][k] + G[k][j])


for k in range(N+1):  # floyd_warshall
    update(k)

for _ in range(int(input())):  # Q
    ty, *op = map(int, input().split())
    if ty == 1:  # (x<y), x<->y ã®é“ã‚’ä½œã‚‹. x,y é–“ã‚’ time=t ã§ç§»å‹•å¯èƒ½
        x, y, t = op
        G[x][y] = G[y][x] = min(G[x][y], t*2)  # x<->y, cost=t*2
        update(x)
        update(y)

    elif ty == 2:  # x ã®è¡—ã«ç©ºæ¸¯ã‚’ä½œã‚‹. ä»–ã®ç©ºæ¸¯ã®ã‚ã‚‹è¡—ã¸ time=T ã§ç§»å‹•å¯èƒ½
        x = op[0]
        G[0][x] = G[x][0] = T  # x<->sky, cost=T
        update(0)
        update(x)

    else:  # if ty == 3:  # Î£Î£f(x,y) ã‚’å‡ºåŠ›
        tot = 0
        for i in range(1, N+1):
            for j in range(1, i):
                tot += G[i][j] if G[i][j] != INF else 0
        print(tot)

##################################################################
[cgpt AC]

---

## ğŸ”· å…¨ä½“ã®ç›®çš„

* è¤‡æ•°ã®ç”ºã¨é“ã€ç©ºæ¸¯ã‹ã‚‰ãªã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãŠã„ã¦ã€

  * å…¨ã¦ã®ç”ºã® **æœ€çŸ­è·é›¢ã®åˆè¨ˆ** ã‚’é«˜é€Ÿã«æ±‚ã‚ã‚‹ã€‚
  * ç©ºæ¸¯ã®è¿½åŠ ã‚„é“è·¯ã®è¿½åŠ ã¨ã„ã£ãŸã‚¯ã‚¨ãƒªã«å¯¾ã—ã¦ã€
    **æœ€çŸ­è·é›¢ã‚’å‹•çš„ã«æ›´æ–°**ã—ã¤ã¤ã€åˆè¨ˆè·é›¢ã‚’ç®¡ç†ã™ã‚‹ã€‚

---

## ğŸ”¸ æ‰‹é †ã®æµã‚Œï¼ˆã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«ï¼‰

### â‘  å…¥åŠ›ã®å—ã‘å–ã‚Šã¨åˆæœŸåŒ–

1. **ç”ºã®æ•°ã¨é“ã®æ•°ã‚’å—ã‘å–ã‚‹**
2. **å…¨ã¦ã®ç”ºãƒšã‚¢é–“ã®è·é›¢è¡Œåˆ—ï¼ˆ2æ¬¡å…ƒé…åˆ—ï¼‰ã‚’ä½œæˆ**

   * åˆæœŸå€¤ã¯ã€Œç„¡é™å¤§ã€
   * è‡ªåˆ†è‡ªèº«ã¸ã®è·é›¢ã¯ 0
3. **å„é“è·¯ã‚’èª­ã¿å–ã‚Šã€è·é›¢è¡Œåˆ—ã«åæ˜ **

   * åŒã˜é“è·¯ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã¯ã€æœ€å°ã®è·é›¢ã®ã¿ä¿æŒ
   * è·é›¢ã¯å†…éƒ¨çš„ã« 2 å€ã«ã—ã¦ä¿æŒï¼ˆæ•´æ•°å‡¦ç†ã®ãŸã‚ï¼‰

---

### â‘¡ ç©ºæ¸¯æƒ…å ±ã®åæ˜ 

4. **ç©ºæ¸¯ã®ã‚ã‚‹ç”ºã®ãƒªã‚¹ãƒˆã‚’å—ã‘å–ã‚‹**
5. **ã€Œãƒ€ãƒŸãƒ¼ç©ºæ¸¯ãƒãƒ¼ãƒ‰ã€ã‚’å°å…¥**

   * å„ç©ºæ¸¯ã®ã‚ã‚‹ç”ºã¨ã“ã®ãƒãƒ¼ãƒ‰ã®é–“ã«ã€ã‚³ã‚¹ãƒˆ `T` ã§åŒæ–¹å‘æ¥ç¶š
   * ç©ºæ¸¯ã‚’é€šã˜ãŸç”ºé–“ç§»å‹•ã‚’ã€ãƒ€ãƒŸãƒ¼ãƒãƒ¼ãƒ‰çµŒç”±ã¨ã—ã¦è¡¨ç¾

---

### â‘¢ åˆæœŸã®æœ€çŸ­è·é›¢è¨ˆç®—

6. **ãƒ¯ãƒ¼ã‚·ãƒ£ãƒ«ãƒ»ãƒ•ãƒ­ã‚¤ãƒ‰æ³•ã§å…¨ç”ºé–“ã®æœ€çŸ­è·é›¢ã‚’è¨ˆç®—**

   * ç©ºæ¸¯ã‚’å«ã‚ãŸæœ€çŸ­è·é›¢ã‚‚è‡ªå‹•çš„ã«åæ˜ ã•ã‚Œã‚‹

---

### â‘£ æœ€çŸ­è·é›¢åˆè¨ˆã®åˆæœŸè¨ˆç®—

7. **ã™ã¹ã¦ã®ç”ºã®ãƒšã‚¢ã«ã¤ã„ã¦ã€æœ€çŸ­è·é›¢ã®åˆè¨ˆã‚’è¨ˆç®—**

   * é‡è¤‡ã—ãªã„ã‚ˆã†ã€`i < j` ã®ãƒšã‚¢ã®ã¿åˆè¨ˆã«åŠ ç®—
   * ã“ã®åˆè¨ˆã‚’ `ANS` å¤‰æ•°ã«ä¿æŒ

---

### â‘¤ ã‚¯ã‚¨ãƒªå‡¦ç†ï¼ˆQå›ï¼‰

8. ã‚¯ã‚¨ãƒªã¯æ¬¡ã®3ç¨®é¡ã®ã„ãšã‚Œã‹ï¼š

#### ğŸ”¹ ã‚¯ã‚¨ãƒªã‚¿ã‚¤ãƒ— 1: é“è·¯ã®è¿½åŠ 

* æŒ‡å®šã•ã‚ŒãŸ2ã¤ã®ç”ºé–“ã«æ–°ã—ã„é“ã‚’è¿½åŠ 
* è·é›¢ãŒçŸ­ããªã‚‹ç”ºã®ãƒšã‚¢ãŒã‚ã‚Œã°ã€æœ€çŸ­è·é›¢ã¨åˆè¨ˆã‚’æ›´æ–°

#### ğŸ”¹ ã‚¯ã‚¨ãƒªã‚¿ã‚¤ãƒ— 2: ç©ºæ¸¯ã®è¿½åŠ 

* ã‚ã‚‹ç”ºã«æ–°ãŸã«ç©ºæ¸¯ã‚’è¿½åŠ 
* ãƒ€ãƒŸãƒ¼ãƒãƒ¼ãƒ‰ã¨æ¥ç¶šã—ã€ç©ºæ¸¯çµŒç”±ã§çŸ­ããªã‚‹ç”ºã®è·é›¢ãŒã‚ã‚Œã°æ›´æ–°

#### ğŸ”¹ ã‚¯ã‚¨ãƒªã‚¿ã‚¤ãƒ— 3: è·é›¢åˆè¨ˆã®å‡ºåŠ›

* ç¾åœ¨ã®å…¨ç”ºãƒšã‚¢ã®æœ€çŸ­è·é›¢åˆè¨ˆã‚’ãã®ã¾ã¾å‡ºåŠ›ï¼ˆä¿å­˜ç”¨ãƒªã‚¹ãƒˆã«è¿½åŠ ï¼‰

---

### â‘¥ å‡ºåŠ›

9. æœ€å¾Œã«ã€**ã‚¿ã‚¤ãƒ—3ã‚¯ã‚¨ãƒªã§è¨˜éŒ²ã—ãŸè·é›¢åˆè¨ˆã‚’é †ã«å‡ºåŠ›**

---

## ğŸ§  å·¥å¤«ã•ã‚ŒãŸç‚¹

| å·¥å¤«     | èª¬æ˜                                |
| ------ | --------------------------------- |
| è·é›¢2å€   | å°æ•°ã‚’ä½¿ã‚ãšæ•´æ•°ã§å‡¦ç†ã™ã‚‹ãŸã‚ã€‚å‡ºåŠ›æ™‚ã«æˆ»ã™å¿…è¦ãªã—ï¼ˆé‡è¤‡å›é¿æ¸ˆï¼‰ |
| ãƒ€ãƒŸãƒ¼ãƒãƒ¼ãƒ‰ | ç©ºæ¸¯ã‚’1ãƒãƒ¼ãƒ‰ã§ä¸€å…ƒç®¡ç†ã§ãã€ç©ºæ¸¯é–“æ¥ç¶šã®æœ€çŸ­è·é›¢ãŒç°¡æ½”ã«è¡¨ç¾å¯èƒ½ |
| éƒ¨åˆ†çš„å†è¨ˆç®— | æ¯å›å…¨ä½“ã‚’å†è¨ˆç®—ã›ãšã€å¤‰æ›´ãŒã‚ã‚‹ã¨ã“ã‚ã ã‘æ›´æ–°ã—ã¦é«˜é€ŸåŒ–      |

---

## âœ… ã“ã®ã‚³ãƒ¼ãƒ‰ãŒå¾—æ„ãªå•é¡Œã‚¿ã‚¤ãƒ—

* é »ç¹ã«ã‚°ãƒ©ãƒ•ãŒæ›´æ–°ã•ã‚Œã‚‹ï¼ˆé“è·¯è¿½åŠ ãƒ»ç©ºæ¸¯è¿½åŠ ï¼‰
* å„æ›´æ–°å¾Œã«**å…¨ä½“ã®è·é›¢åˆè¨ˆã‚’çŸ¥ã‚ŠãŸã„**
* å°è¦æ¨¡ã€œä¸­è¦æ¨¡ã®ã‚°ãƒ©ãƒ•ï¼ˆæœ€å¤§ç´„100ãƒãƒ¼ãƒ‰ç¨‹åº¦ï¼‰

---

##################################################################
[cgpt AC]
import sys
input = sys.stdin.readline

INF = 1 << 60

N, M = map(int, input().split())
D = [[INF] * (N + 1) for _ in range(N + 1)]

for i in range(N + 1):
    D[i][i] = 0

for _ in range(M):
    a, b, c = map(int, input().split())
    a -= 1
    b -= 1
    c *= 2
    D[a][b] = D[b][a] = min(D[a][b], c)

K, T = map(int, input().split())
Air = list(map(lambda x: int(x) - 1, input().split()))

for a in Air:
    D[a][N] = D[N][a] = T

# ãƒ¯ãƒ¼ã‚·ãƒ£ãƒ«ãƒ»ãƒ•ãƒ­ã‚¤ãƒ‰
for k in range(N + 1):
    for i in range(N + 1):
        for j in range(N + 1):
            D[i][j] = min(D[i][j], D[i][k] + D[k][j])

# è·é›¢åˆè¨ˆï¼ˆi<jã®ã¿ï¼‰
ANS = sum(D[i][j] for i in range(N) for j in range(i + 1, N) if D[i][j] < INF)

def update_dist(x, y, new_dist):
    global ANS
    for i in range(N + 1):
        for j in range(i + 1, N + 1):
            d1 = D[i][x] + new_dist + D[y][j]
            d2 = D[i][y] + new_dist + D[x][j]
            d = min(d1, d2)
            if d < D[i][j]:
                if i < N and j < N:
                    if D[i][j] >= INF:
                        ANS += d
                    else:
                        ANS -= D[i][j] - d
                D[i][j] = D[j][i] = d

Q = int(input())
LANS = []

for _ in range(Q):
    L = list(map(int, input().split()))
    t = L[0]
    if t == 3:
        LANS.append(ANS)
    elif t == 2:
        x = L[1] - 1
        D[x][N] = D[N][x] = T
        update_dist(x, N, T)
    elif t == 1:
        x, y, z = L[1] - 1, L[2] - 1, L[3] * 2
        if D[x][y] > z:
            update_dist(x, y, z)

# å‡ºåŠ›ï¼ˆåˆè¨ˆè·é›¢ã¯å†…éƒ¨ã§1å›ã®ã¿æ•°ãˆãŸã®ã§ /2 ä¸è¦ï¼‰
print(*LANS)

##################################################################
[titia]
import sys
input = sys.stdin.readline

N,M=map(int,input().split())

D=[[1<<60]*(N+1) for i in range(N+1)]

for i in range(N+1):
    D[i][i]=0

for i in range(M):
    a,b,c=map(int,input().split())
    a-=1
    b-=1
    c*=2
    D[a][b]=min(D[a][b],c)
    D[b][a]=min(D[b][a],c)

K,T=map(int,input().split())
Air=list(map(int,input().split()))

for air in Air:
    D[air-1][N]=T
    D[N][air-1]=T

for k in range(N+1): # kå€‹ã¾ã§ã®ç”ºã‚’ä½¿ã£ã¦ã®DisãŒçŸ¥ã‚Œã¦ã„ã‚‹ã¨ãã«
    for i in range(N+1): # ç”ºiã¨
        for j in range(N+1): # ç”ºjã¨ã®æœ€çŸ­è·é›¢ã¯ã€
            length=D[i][k]+D[j][k]
            if D[i][j]>length:
                D[i][j]=D[j][i]=length

ANS=0
for i in range(N):
    for j in range(N):
        if D[i][j]<(1<<60):
            ANS+=D[i][j]

Q=int(input())
LANS=[]

for tests in range(Q):
    L=list(map(int,input().split()))
    #print(L,D)

    if L[0]==3:
        LANS.append(ANS//2)
    elif L[0]==2:
        x=L[1]-1
        D[x][N]=T
        D[N][x]=T

        for i in range(N+1):
            for j in range(i+1,N+1):
                length=min(D[i][x]+T+D[j][N],D[i][N]+T+D[j][x])

                if length<D[i][j]:
                    if i<N and j<N:
                        if D[i][j]>=(1<<60):
                            ANS+=length*2
                        else:
                            ANS-=(D[i][j]-length)*2
                    D[i][j]=length
                    D[j][i]=length
    elif L[0]==1:
        #print("!!",ANS)
        x,y,z=L[1],L[2],L[3]
        x-=1
        y-=1
        z*=2

        if D[x][y]>z:
            for i in range(N+1):
                for j in range(i+1,N+1):
                    length=min(D[i][x]+z+D[j][y],D[i][y]+z+D[j][x])

                    if length<D[i][j]:
                    
                        if i<N and j<N:
                            if D[i][j]>=(1<<60):
                                ANS+=length*2
                            else:
                                ANS-=(D[i][j]-length)*2

                        #print(D[i][j],length,ANS)
                        D[i][j]=length
                        D[j][i]=length

print(*LANS)

##################################################################
